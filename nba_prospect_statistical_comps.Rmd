---
title: "NBA Prospect Player Comps"
date: "8/27/2020"
---

import tidyverse
```{r}
library(tidyverse)
```

load ncaa csv files
```{r}
#totals
ncaa_player_totals <- as_tibble(read.csv("ncaa_player_totals_2003_2020.csv"))
ncaa_player_totals_opponents_greater_500 <- as_tibble(read.csv("ncaa_player_totals_opponents_greater_500_2003_2020.csv"))
ncaa_player_totals_conference_games <- as_tibble(read.csv("ncaa_player_totals_conference_games_reg_season_2003_2020.csv"))
ncaa_player_totals_opponents_top_25 <- as_tibble(read.csv("ncaa_player_totals_opponents_top_25_2003_2020.csv"))
#combine into list
totals.list <- list(ncaa_player_totals, ncaa_player_totals_opponents_greater_500, ncaa_player_totals_conference_games, ncaa_player_totals_opponents_top_25)


#advanced
ncaa_player_advanced <- as_tibble(read.csv("ncaa_player_advanced_2003_2020.csv"))
ncaa_player_advanced_opponents_greater_500 <- as_tibble(read.csv("ncaa_player_advanced_opponents_greater_500_2003_2020.csv"))
ncaa_player_advanced_conference_games <- as_tibble(read.csv("ncaa_player_advanced_conference_games_reg_season_2003_2020.csv"))
ncaa_player_advanced_opponents_top_25 <- as_tibble(read.csv("ncaa_player_advanced_opponents_top_25_2003_2020.csv"))
#combine into list
advanced.list <- list(ncaa_player_advanced, ncaa_player_advanced_opponents_greater_500, ncaa_player_advanced_conference_games, ncaa_player_advanced_opponents_top_25)

#misc
ncaa_player_misc <- as_tibble(read.csv("ncaa_player_misc_2003_2020.csv"))
ncaa_player_misc_opponents_greater_500 <- as_tibble(read.csv("ncaa_player_misc_opponents_greater_500_2003_2020.csv"))
ncaa_player_misc_conference_games <- as_tibble(read.csv("ncaa_player_misc_conference_games_reg_season_2003_2020.csv"))
ncaa_player_misc_opponents_top_25<- as_tibble(read.csv("ncaa_player_misc_opponents_top_25_2003_2020.csv"))
#combine into list
misc.list <- list(ncaa_player_misc, ncaa_player_misc_opponents_greater_500, ncaa_player_misc_conference_games, ncaa_player_misc_opponents_top_25)

#player info table with height/weight/class
ncaa_player_info <- as_tibble(read.csv("ncaa_player_info_2003_2020.csv"))

#school info with strength of schedule and rpi 
ncaa_school_info <- as_tibble(read.csv("ncaa_school_info_2003_2020.csv"))


#players drafted
ncaa_players_drafted <- as_tibble(read.csv("ncaa_players_drafted_2003_2019.csv"))
#rename season column to drafted
ncaa_players_drafted <- ncaa_players_drafted %>% 
  rename(
    Draft = Season,
    )

```


load nba csv files
```{r}
nba_player_career_averages <- as_tibble(read.csv("nba_player_career_averages_1947_2020.csv"))
nba_player_career_totals <- as_tibble(read.csv("nba_player_career_totals_1947_2020.csv"))
nba_player_career_advanced <- as_tibble(read.csv("nba_player_career_advanced_1947_2020.csv"))
nba_player_career_misc <- as_tibble(read.csv("nba_player_career_misc_1981_2020.csv"))
```


join nba files together, select subset of columns, calcuate WS/48 and add prefix to differentiate from ncaa stats
```{r}
#join averages with advanced
nba_career_stats <- merge(nba_player_career_averages, nba_player_career_advanced, by = "Player_ID")
#join to misc
nba_career_stats <- merge(nba_career_stats, nba_player_career_misc, by = "Player_ID")

#select subset of columns
nba_career_stats <- select(nba_career_stats, Player_ID, GP, PTS, REB, AST,STL, BLK, FGA, FGpct, PPS, TSpct, USGpct, ThreePA, ThreePct, TRBpct, ASTpct, STLpct, BLKpct, OWS, DWS, WS)

#join to nba totals table to get career minutes in order to calculate WS/48
nba_career_stats <- merge(nba_career_stats, select(nba_player_career_totals, Player_ID, MIN), by = "Player_ID")
#calculate WS per 48
nba_career_stats$WS48 <- round((nba_career_stats$WS / nba_career_stats$MIN) * 48,3)
#remove MIN column
nba_career_stats <- subset(nba_career_stats, select=-c(MIN))

#add nba_ prefix to stat columns
colnames(nba_career_stats)[c(2:22)] <- paste("nba", colnames(nba_career_stats)[c(2:22)], sep = "_")

```

join each table from ncaa lists with nba table
```{r}

totals.list <- lapply(totals.list, function(x) left_join(x, nba_career_stats, by = c("Player_ID")))
advanced.list <- lapply(advanced.list, function(x) left_join(x, nba_career_stats, by = c("Player_ID")))
misc.list <- lapply(misc.list, function(x) left_join(x, nba_career_stats, by = c("Player_ID")))

```

join each table from ncaa lists with drafted table
```{r}

totals.list <- lapply(totals.list,  function(x) left_join(x, select(ncaa_players_drafted, c(Player_ID, Draft)), by = c("Player_ID")))
advanced.list <- lapply(advanced.list,  function(x) left_join(x, select(ncaa_players_drafted, c(Player_ID, Draft)), by = c("Player_ID")))
misc.list <- lapply(misc.list,  function(x) left_join(x, select(ncaa_players_drafted, c(Player_ID, Draft)), by = c("Player_ID")))

```

remove N/A values for height and weight
```{r}
ncaa_player_info = filter(ncaa_player_info, HT != 'N/A' & WT != 'N/A')
```

replace Class column with numbers
```{r}
#view unique values
unique(ncaa_player_info$Class)

#remove ineligible and transfer players
ncaa_player_info = filter(ncaa_player_info, !grepl("Ineligible|Transfer", Class))

#replace classes with numbers (RS years need to be done first since replacement does not need an exact match)
#numbers represent years in school to try to emulate age of player
ncaa_player_info$Class <- str_replace_all(ncaa_player_info$Class, 
                c("RS-Fr" = "2", 
                  "Fr" = "1",
                  "RS-So" = "3",
                  "So" = "2",
                  "RS-Jr" = "4",
                  "Jr" = "3",
                  "RS-Sr" = "5",
                  "Sr" = "4"))

#convert Class to numeric
ncaa_player_info$Class <- as.numeric(ncaa_player_info$Class)

```


convert height to inches
```{r}
ncaa_player_info$HT <- sapply(strsplit(as.character(ncaa_player_info$HT),"-"),
        function(x){12*as.numeric(x[1]) + as.numeric(x[2])})
```

convert WT to numeric
```{r}
ncaa_player_info$WT <- as.numeric(ncaa_player_info$WT)
```

################################ totals.list ###############################
prepare tables in totals.list 

join totals.list table with player info table and school info table
```{r}

#remove school column from totals.list table as I will use School column from info table
totals.list <- lapply(totals.list,  function(x) subset(x, select=-c(School)))

#join with player info table to get player height, weight and class
totals.list <- lapply(totals.list,  function(x) left_join(x, select(ncaa_player_info, c(Player_ID, Season, School, Pos, HT, WT, Class)), by = c("Player_ID", "Season")))


#join with school info table to get strenth of schedule
totals.list <- lapply(totals.list,  function(x) left_join(x, select(ncaa_school_info, c(Season, School, SOS)), by = c("School", "Season")))


#select and rearrange columns
totals.list <- lapply(totals.list,  function(x) select(x, c(Player_ID, Player, Season, School, Type, Pos, Draft, MIN, SOS, Class, HT, WT, FGM, FGA, ThreePM, ThreePA, FTM, FTA, TOV, PF, ORB, DRB, AST, STL, BLK, nba_GP, nba_PTS, nba_REB, nba_AST, nba_STL, nba_BLK, nba_FGA, nba_FGpct, nba_PPS, nba_USGpct, nba_TSpct, nba_ThreePA, nba_ThreePct, nba_TRBpct, nba_ASTpct, nba_STLpct, nba_BLKpct, nba_OWS, nba_DWS, nba_WS, nba_WS48)))


#remove rows with null values from info table
totals.list <- lapply(totals.list,  function(x) filter(x, is.na(Class) != TRUE))
```

only include players with greater > 200 minutes played in totals.list table that includes all games and 100 minutes played in others
```{r}
totals.list[[1]] <- filter(totals.list[[1]], MIN >= 200)
totals.list[[2]] <- filter(totals.list[[2]], MIN >= 100)
totals.list[[3]] <- filter(totals.list[[3]], MIN >= 100)
totals.list[[4]] <- filter(totals.list[[4]], MIN >= 100)
```


Calculate per minute stats for each of the totals.list tables
```{r}
totals_per_min <- lapply(totals.list,  function(x) mutate(x, 
                         FGM=FGM/MIN,
                         FGA=FGA/MIN,
                         ThreePM=ThreePM/MIN,
                         ThreePA=ThreePA/MIN,
                         FTM=FTM/MIN,
                         FTA=FTA/MIN,
                         TOV=TOV/MIN,
                         PF=PF/MIN,
                         ORB=ORB/MIN,
                         DRB=DRB/MIN,
                         AST=AST/MIN,
                         STL=STL/MIN,
                         BLK=BLK/MIN))

```

scale data for totals.list and totals_per_min data
```{r}
#create new data frames for scaled data
totals_scaled <- totals.list
totals_per_min_scaled <- totals_per_min

#scale SOS, MIN, Class, HT,and WT data for entire totals_scaled data
totals_scaled <- lapply(totals_scaled, function(x) within(x, {
    SOS <- scale(SOS)
    MIN <- scale(MIN)
    Class <- scale(Class)
    HT <- scale(HT)
    WT <- scale(WT)
}))


#scale Class, HT, and WT for entire totals_per_min_scaled data. Since per_minute, I do not need to include MIN
totals_per_min_scaled <- lapply(totals_per_min_scaled, function(x) within(x, {
    SOS <- scale(SOS)
    Class <- scale(Class)
    HT <- scale(HT)
    WT <- scale(WT)
}))



#scale player stats by season to account for changes in tempo and playing styles (rename so that non-scaled stats can be used in final output)
totals_scaled <- lapply(totals_scaled, function(x) x %>% group_by(Season) %>% mutate(FGM=scale(FGM), 
                                                        FGA=scale(FGA),
                                                        ThreePM=scale(ThreePM),
                                                        ThreePA=scale(ThreePA),
                                                        FTM=scale(FTM),
                                                        FTA=scale(FTA),
                                                        TOV=scale(TOV),
                                                        PF=scale(PF),
                                                        ORB=scale(ORB),
                                                        DRB=scale(DRB),
                                                        AST=scale(AST),
                                                        STL=scale(STL),
                                                        BLK=scale(BLK)))

#scale per minute player stats by season to account for changes in tempo and playing styles
totals_per_min_scaled <- lapply(totals_per_min_scaled, function(x) x %>% group_by(Season) %>% mutate(FGM=scale(FGM), 
                                                        FGA=scale(FGA),
                                                        ThreePM=scale(ThreePM),
                                                        ThreePA=scale(ThreePA),
                                                        FTM=scale(FTM),
                                                        FTA=scale(FTA),
                                                        TOV=scale(TOV),
                                                        PF=scale(PF),
                                                        ORB=scale(ORB),
                                                        DRB=scale(DRB),
                                                        AST=scale(AST),
                                                        STL=scale(STL),
                                                        BLK=scale(BLK)))
```


################################ advanced.list ###############################
prepare tables in advanced.list 

join advanced.list table with totals.list table to get player minutes, misc.list table to get WS and info table to get height, weight, class
```{r}
#remove school column from advanced.list table as I will use School column from info table
advanced.list <- lapply(advanced.list,  function(x) subset(x, select=-c(School)))

#join each advanced.list table to corresponding totals.list table to get player minutes
advanced.list[[1]] <- left_join(advanced.list[[1]], select(totals.list[[1]], c(Player_ID, Season, MIN)), by = c("Player_ID", "Season"))
advanced.list[[2]] <- left_join(advanced.list[[2]], select(totals.list[[2]], c(Player_ID, Season, MIN)), by = c("Player_ID", "Season"))
advanced.list[[3]] <- left_join(advanced.list[[3]], select(totals.list[[3]], c(Player_ID, Season, MIN)), by = c("Player_ID", "Season"))
advanced.list[[4]] <- left_join(advanced.list[[4]], select(totals.list[[4]], c(Player_ID, Season, MIN)), by = c("Player_ID", "Season"))

#join each advanced.list.list table to corresponding misc.list table to get player Win Shares
advanced.list[[1]] <- left_join(advanced.list[[1]], select(misc.list[[1]], c(Player_ID, Season, OWS, DWS)), by = c("Player_ID", "Season"))
advanced.list[[2]] <- left_join(advanced.list[[2]], select(misc.list[[2]], c(Player_ID, Season, OWS, DWS)), by = c("Player_ID", "Season"))
advanced.list[[3]] <- left_join(advanced.list[[3]], select(misc.list[[3]], c(Player_ID, Season, OWS, DWS)), by = c("Player_ID", "Season"))
advanced.list[[4]] <- left_join(advanced.list[[4]], select(misc.list[[4]], c(Player_ID, Season, OWS, DWS)), by = c("Player_ID", "Season"))

#get player OWS & DWS Per Minute
advanced.list <- lapply(advanced.list, function(x) x %>% mutate(OWS_per_min=OWS/MIN, 
                                                        DWS_per_min=DWS/MIN))


#join to player info table to get height, weight, class
advanced.list <- lapply(advanced.list,  function(x) left_join(x, select(ncaa_player_info, c(Player_ID, Season, School, Pos, HT, WT, Class)), by = c("Player_ID", "Season")))

#join to school info table to get SOS
advanced.list <- lapply(advanced.list,  function(x) left_join(x, select(ncaa_school_info, c(Season, School, SOS)), by = c("School", "Season")))


#select and rearrange columns
advanced.list <- lapply(advanced.list,  function(x) select(x, c(Player_ID, Player, Season, School, Type, Pos, Draft, MIN, OWS_per_min, DWS_per_min, SOS, Class, HT, WT, TSpct, ORBpct, DRBpct, ASTpct, TOVpct, STLpct, BLKpct, USGpct, OWS, DWS, nba_GP, nba_PTS, nba_REB, nba_AST, nba_STL, nba_BLK, nba_FGA, nba_FGpct, nba_PPS, nba_USGpct, nba_TSpct, nba_ThreePA, nba_ThreePct, nba_TRBpct, nba_ASTpct, nba_STLpct, nba_BLKpct, nba_OWS, nba_DWS, nba_WS, nba_WS48)))

#remove rows with null values in columns from info table
advanced.list <- lapply(advanced.list,  function(x) filter(x, is.na(Class) != TRUE))
```

only include players with greater > 200 minutes played for all games and > 100 minutes for other tables. Also remove outliers for STL% for all games table
```{r}
advanced.list[[1]] <- filter(advanced.list[[1]], MIN >= 200)
advanced.list[[2]] <- filter(advanced.list[[2]], MIN >= 100)
advanced.list[[3]] <- filter(advanced.list[[3]], MIN >= 100)
advanced.list[[4]] <- filter(advanced.list[[4]], MIN >= 100)


advanced.list[[1]] <- filter(advanced.list[[1]], STLpct <= 10)
```


scale data for advanced.list data
```{r}
#create new data frames for scaled data
advanced_scaled <- advanced.list


advanced_scaled <- lapply(advanced_scaled, function(x) within(x, {
    SOS <- scale(SOS)
    Class <- scale(Class)
    HT <- scale(HT)
    WT <- scale(as.numeric(WT))
}))

#scale player stats by season to account for changes in tempo and playing styles
advanced_scaled <- lapply(advanced_scaled, function(x) x %>% group_by(Season) %>% mutate(TSpct=scale(TSpct), 
                                                        ORBpct=scale(ORBpct),
                                                        DRBpct=scale(DRBpct),
                                                        ASTpct=scale(ASTpct),
                                                        TOVpct=scale(TOVpct),
                                                        STLpct=scale(STLpct),
                                                        BLKpct=scale(BLKpct),
                                                        USGpct=scale(USGpct),
                                                        OWS=scale(OWS),
                                                        DWS=scale(DWS),
                                                        OWS_per_min=scale(OWS_per_min),
                                                        DWS_per_min=scale(DWS_per_min)))

```


################ Calculate Similar Players ####################

load in FNN library
```{r}
library(FNN)
```

########### Basic Stat Comparisons ##############

Basic Stats - Totals -  All Games - NBA Players Only
```{r}
#get table for just basic stats - all games
data <- totals_scaled[[1]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numerical columns
master_players_numeric = master_players[8:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numerical columns
current_players_numeric = current_players[8:25]
#get row index of most similar players
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
basic_max_dist <- max(basic_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
basic_nba[16:25] <- (1- (basic_nba[16:25] / basic_max_dist)) * 100

```


Basic Stats - Totals -  All Games - All Players
```{r}
#get table for just basic stats
data <- totals_scaled[[1]]


for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[8:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[8:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
basic[16:25] <- (1- (basic[16:25] / basic_max_dist)) * 100

```


Basic Stats - Totals - Opponents Greater than .500 - NBA Players Only
```{r}
#get table for just basic stats
data <- totals_scaled[[2]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[8:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[8:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_opponents_greater_500_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
basic_opponents_greater_500_max_dist <- max(basic_opponents_greater_500_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
basic_opponents_greater_500_nba[16:25] <- (1- (basic_opponents_greater_500_nba[16:25] / basic_opponents_greater_500_max_dist)) * 100

```


Basic Stats - Totals - Opponents Greater than .500 - All Players
```{r}
#get table for just basic stats
data <- totals_scaled[[2]]


for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[8:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[8:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_opponents_greater_500 <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
basic_opponents_greater_500[16:25] <- (1- (basic_opponents_greater_500[16:25] / basic_opponents_greater_500_max_dist)) * 100

```


Basic Stat - Totals - Conference Games - NBA Players Only
```{r}
#get table for just basic stats
data <- totals_scaled[[3]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[8:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[8:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_conference_games_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
basic_conference_games_max_dist <- max(basic_conference_games_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
basic_conference_games_nba[16:25] <- (1- (basic_conference_games_nba[16:25] / basic_conference_games_max_dist)) * 100

```


Basic Stat - Totals - Conference Games - All Players
```{r}
#get table for just basic stats
data <- totals_scaled[[3]]


for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[8:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[8:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_conference_games <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
basic_conference_games[16:25] <- (1- (basic_conference_games[16:25] / basic_conference_games_max_dist)) * 100

```


Basic Stat - Totals - Top 25 Games - NBA Players Only
```{r}
#get table for just basic stats
data <- totals_scaled[[4]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[8:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[8:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_top_25_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
basic_top_25_max_dist <- max(basic_top_25_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
basic_top_25_nba[16:25] <- (1- (basic_top_25_nba[16:25] / basic_top_25_max_dist)) * 100

```


Basic Stats - Totals - Top 25 Games -  All Players
```{r}
#get table for just basic stats
data <- totals_scaled[[4]]


for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[8:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[8:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_top_25 <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
basic_top_25[16:25] <- (1- (basic_top_25[16:25] / basic_top_25_max_dist)) * 100

```


######### Basic Par Minute Stat Comparisons #########

Basic - Per Minute - All games - NBA Players
```{r}
data <- totals_per_min_scaled[[1]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[9:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_per_min_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance
basic_per_min_max_dist <- max(basic_per_min_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
basic_per_min_nba[16:25] <- (1- (basic_per_min_nba[16:25] / basic_per_min_max_dist)) * 100
```



Basic - Per Minute - All games - All Players
```{r}
data <- totals_per_min_scaled[[1]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[9:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_per_min <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#convert distances to 0-100 scale based on all max distance from nba distances
basic_per_min[16:25] <- (1- (basic_per_min[16:25] / basic_per_min_max_dist)) * 100
```



Basic - Per Minute - Opponents Greater than .500 - NBA Players Only
```{r}
data <- totals_per_min_scaled[[2]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[9:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_per_min_opponents_greater_500_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance
basic_per_min_opponents_greater_500_max_dist <- max(basic_per_min_opponents_greater_500_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
basic_per_min_opponents_greater_500_nba[16:25] <- (1- (basic_per_min_opponents_greater_500_nba[16:25] / basic_per_min_opponents_greater_500_max_dist)) * 100
```

Basic - Per Minute - Opponents Greater than .500 - All Players 
```{r}
data <- totals_per_min_scaled[[2]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[9:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_per_min_opponents_greater_500 <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
basic_per_min_opponents_greater_500[16:25] <- (1- (basic_per_min_opponents_greater_500[16:25] / basic_per_min_opponents_greater_500_max_dist)) * 100
```


Basic - Per Minute - Conference Games - NBA Players Only
```{r}
data <- totals_per_min_scaled[[3]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[9:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_per_min_conference_games_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance
basic_per_min_conference_games_max_dist <- max(basic_per_min_conference_games_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
basic_per_min_conference_games_nba[16:25] <- (1- (basic_per_min_conference_games_nba[16:25] / basic_per_min_conference_games_max_dist)) * 100
```


Basic - Per Minute - Conference Games - All Players
```{r}
data <- totals_per_min_scaled[[3]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[9:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_per_min_conference_games <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
basic_per_min_conference_games[16:25] <- (1- (basic_per_min_conference_games[16:25] / basic_per_min_conference_games_max_dist)) * 100
```


Basic - Per Minute - Top 25 - NBA Players Only
```{r}
data <- totals_per_min_scaled[[4]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[9:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_per_min_top_25_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance
basic_per_min_top_25_max_dist <- max(basic_per_min_top_25_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
basic_per_min_top_25_nba[16:25] <- (1- (basic_per_min_top_25_nba[16:25] / basic_per_min_top_25_max_dist)) * 100
```


Basic - Per Minute - Top 25 - All Players
```{r}
data <- totals_per_min_scaled[[4]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[9:25]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:25]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
basic_per_min_top_25 <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
basic_per_min_top_25[16:25] <- (1- (basic_per_min_top_25[16:25] / basic_per_min_top_25_max_dist)) * 100
```

############ Advanced Stat Comparisons ##############

Advanced Stats - Total Win Shares - All Games - NBA Players Only
```{r}
#get table for just basic stats
data <- advanced_scaled[[1]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[11:24]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[11:24]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
advanced_max_dist <- max(advanced_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
advanced_nba[16:25] <- (1- (advanced_nba[16:25] / advanced_max_dist)) * 100

```


Advanced Stats - Total Win Shares - All Games - All Players
```{r}

data <- advanced_scaled[[1]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[11:24]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[11:24]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
advanced[16:25] <- (1- (advanced[16:25] / advanced_max_dist)) * 100

```


Advanced Stats - Total Win Shares - Opponents Greater .500 - NBA Players Only
```{r}

data <- advanced_scaled[[2]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[11:24]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[11:24]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_opponents_greater_500_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
advanced_opponents_greater_500_max_dist <- max(advanced_opponents_greater_500_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
advanced_opponents_greater_500_nba[16:25] <- (1- (advanced_opponents_greater_500_nba[16:25] / advanced_opponents_greater_500_max_dist)) * 100

```


Advanced Stats - Total Win Shares - Opponents Greater .500 - All Players
```{r}
#get table for just basic stats
data <- advanced_scaled[[2]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[11:24]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[11:24]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_opponents_greater_500 <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
advanced_opponents_greater_500[16:25] <- (1- (advanced_opponents_greater_500[16:25] / advanced_opponents_greater_500_max_dist)) * 100
```



Advanced Stats - Total Win Shares - Conference Games - NBA Players Only
```{r}
#get table for just basic stats
data <- advanced_scaled[[3]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[11:24]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[11:24]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_conference_games_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
advanced_conference_games_max_dist <- max(advanced_conference_games_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
advanced_conference_games_nba[16:25] <- (1- (advanced_conference_games_nba[16:25] / advanced_conference_games_max_dist)) * 100

```


Advanced Stats - Total Win Shares - Opponents Greater .500 - All Players
```{r}
#get table for just basic stats
data <- advanced_scaled[[3]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[11:24]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[11:24]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_conference_games <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
advanced_conference_games[16:25] <- (1- (advanced_conference_games[16:25] / advanced_conference_games_max_dist)) * 100

```



Advanced Stats - Total Win Shares - Top 25 - NBA Players Only
```{r}
#get table for just basic stats
data <- advanced_scaled[[4]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[11:24]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[11:24]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_top_25_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
advanced_top_25_max_dist <- max(advanced_top_25_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
advanced_top_25_nba[16:25] <- (1- (advanced_top_25_nba[16:25] / advanced_top_25_max_dist)) * 100

```


Advanced Stats - Total Win Shares - Top 25 - All Players
```{r}
#get table for just basic stats
data <- advanced_scaled[[4]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[11:24]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[11:24]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_top_25 <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
advanced_top_25[16:25] <- (1- (advanced_top_25[16:25] / advanced_top_25_max_dist)) * 100

```


######## Advanced Win Shares Per Minutes Comparisons ##########

Advanced Stats - Per Minute Win Shares - All games - NBA Players Only
```{r}
#get table for just basic stats
data <- advanced_scaled[[1]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[9:22]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:22]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_per_min_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
advanced_per_min_max_dist <- max(advanced_per_min_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
advanced_per_min_nba[16:25] <- (1- (advanced_per_min_nba[16:25] / advanced_per_min_max_dist)) * 100

```


Advanced Stats - Per Minute Win Shares - All games - All Players
```{r}
#get table for just basic stats
data <- advanced_scaled[[1]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[9:22]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:22]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_per_min <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
advanced_per_min[16:25] <- (1- (advanced_per_min[16:25] / advanced_per_min_max_dist)) * 100

```


Advanced Stats - Per Minute Win Shares - Opponents Greater .500 - NBA Players Only
```{r}
#get table for just basic stats
data <- advanced_scaled[[2]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[9:22]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:22]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_per_min_opponents_greater_500_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
advanced_per_min_opponents_greater_500_max_dist <- max(advanced_per_min_opponents_greater_500_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
advanced_per_min_opponents_greater_500_nba[16:25] <- (1- (advanced_per_min_opponents_greater_500_nba[16:25] / advanced_per_min_opponents_greater_500_max_dist)) * 100

```


Advanced Stats - Per Minute Win Shares - Opponents Greater .500 - All Players
```{r}
#get table for just basic stats
data <- advanced_scaled[[2]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[9:22]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:22]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_per_min_opponents_greater_500 <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
advanced_per_min_opponents_greater_500[16:25] <- (1- (advanced_per_min_opponents_greater_500[16:25] / advanced_per_min_opponents_greater_500_max_dist)) * 100
```



Advanced Stats - Per Minute Win Shares - Conference Games - NBA Players Only
```{r}
#get table for just basic stats
data <- advanced_scaled[[3]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[9:22]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:22]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_per_min_conference_games_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
advanced_per_min_conference_games_max_dist <- max(advanced_per_min_conference_games_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
advanced_per_min_conference_games_nba[16:25] <- (1- (advanced_per_min_conference_games_nba[16:25] / advanced_per_min_conference_games_max_dist)) * 100

```


Advanced Stats - Per Minute Win Shares - Conference Games - All Players
```{r}
#get table for just basic stats
data <- advanced_scaled[[3]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[9:22]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:22]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_per_min_conference_games <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
advanced_per_min_conference_games[16:25] <- (1- (advanced_per_min_conference_games[16:25] / advanced_per_min_conference_games_max_dist)) * 100

```



Advanced Stats - Per Minute Win Shares - Top 25 - NBA Players Only
```{r}
#get table for just basic stats
data <- advanced_scaled[[4]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year, nba_GP >0) 
#include only numeric columns
master_players_numeric = master_players[9:22]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:22]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_per_min_top_25_nba <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)

#calculate max distance to use in converting distance to similarity between 0-100
advanced_per_min_top_25_max_dist <- max(advanced_per_min_top_25_nba[16:25])


#convert distances to 0-100 scale based on max distance in nba
advanced_per_min_top_25_nba[16:25] <- (1- (advanced_per_min_top_25_nba[16:25] / advanced_per_min_top_25_max_dist)) * 100

```


Advanced Stats - Per Minute Win Shares - Top 25 - All Players
```{r}
#get table for just basic stats
data <- advanced_scaled[[4]]

for (year in 2010:2020) {
#master players contains players from prior years so that only historical similar players are matched    
master_players = filter(data, Season < year) 
#include only numeric columns
master_players_numeric = master_players[9:22]
#current players contains players for each year iteration
current_players = filter(data, Season == year)
#include only numeric columns
current_players_numeric = current_players[9:22]
#get row index of most similar players 
results_index = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.index
#get distances of similar players
results_dist = get.knnx(master_players_numeric, current_players_numeric, k=10, algorithm=c("kd_tree"))$nn.dist

#use the index of most similar player results to get detailed information (nba stats) for the players
sim_players_list = list()
sim_distances_list = list()
sim_schools_list = list()
sim_seasons_list = list()
sim_GP_list = list()
sim_PTS_list = list()
sim_REB_list = list()
sim_AST_list = list()
sim_STL_list = list()
sim_BLK_list = list()
sim_FGA_list = list()
sim_FGpct_list = list()
sim_PPS_list = list()
sim_USGpct_list = list()
sim_TSpct_list = list()
sim_ThreePA_list = list()
sim_ThreePct_list = list()
sim_TRBpct_list = list()
sim_ASTpct_list = list()
sim_STLpct_list = list()
sim_BLKpct_list = list()
sim_OWS_list = list()
sim_DWS_list = list()
sim_WS_list = list()
sim_WS48_list = list()
#for each of the 10 similar players, assign each stat to a variable
for (i in 1:10) {
    players <- master_players[results_index[,i],'Player']
    distances <- results_dist[,i]
    schools <- master_players[results_index[,i],'School']
    seasons <- master_players[results_index[,i],'Season']
    GP <- master_players[results_index[,i],'nba_GP']
    PTS <- master_players[results_index[,i],'nba_PTS']
    REB <- master_players[results_index[,i],'nba_REB']
    AST <- master_players[results_index[,i],'nba_AST']
    STL <- master_players[results_index[,i],'nba_STL']
    BLK <- master_players[results_index[,i],'nba_BLK']
    FGA <- master_players[results_index[,i],'nba_FGA']
    FGpct <- master_players[results_index[,i],'nba_FGpct']
    PPS <- master_players[results_index[,i],'nba_PPS']
    USGpct <- master_players[results_index[,i],'nba_USGpct']
    TSpct <- master_players[results_index[,i],'nba_TSpct']
    ThreePA <- master_players[results_index[,i],'nba_ThreePA']
    ThreePct <- master_players[results_index[,i],'nba_ThreePct']
    TRBpct <- master_players[results_index[,i],'nba_TRBpct']
    ASTpct <- master_players[results_index[,i],'nba_ASTpct']
    STLpct <- master_players[results_index[,i],'nba_STLpct']
    BLKpct <- master_players[results_index[,i],'nba_BLKpct']
    OWS <- master_players[results_index[,i],'nba_OWS']
    DWS <- master_players[results_index[,i],'nba_DWS']
    WS <- master_players[results_index[,i],'nba_WS']
    WS48 <- master_players[results_index[,i],'nba_WS48']
    
    #add all variables to list for each iteration
    sim_players_list[[i]] <- players
    sim_distances_list[[i]] <- distances
    sim_schools_list[[i]] <- schools
    sim_seasons_list[[i]] <- seasons
    sim_GP_list[[i]] <- GP
    sim_PTS_list[[i]] <- PTS
    sim_REB_list[[i]] <- REB
    sim_AST_list[[i]] <- AST
    sim_STL_list[[i]] <- STL
    sim_BLK_list[[i]] <- BLK
    sim_FGA_list[[i]] <- FGA
    sim_FGpct_list[[i]] <- FGpct
    sim_PPS_list[[i]] <- PPS
    sim_USGpct_list[[i]] <- USGpct
    sim_TSpct_list[[i]] <- TSpct
    sim_ThreePA_list[[i]] <- ThreePA
    sim_ThreePct_list[[i]] <- ThreePct
    sim_TRBpct_list[[i]] <- TRBpct
    sim_ASTpct_list[[i]] <- ASTpct
    sim_STLpct_list[[i]] <- STLpct
    sim_BLKpct_list[[i]] <- BLKpct
    sim_OWS_list[[i]] <- OWS
    sim_DWS_list[[i]] <- DWS
    sim_WS_list[[i]] <- WS
    sim_WS48_list[[i]] <- WS48
    
}


#combine all players in each index of list to one data frame
sim_players <- do.call(cbind, sim_players_list)
sim_distances <- as.data.frame(do.call(cbind, sim_distances_list))
sim_schools <- do.call(cbind, sim_schools_list)
sim_seasons <- as.data.frame(do.call(cbind, sim_seasons_list))
sim_GP <- as.data.frame(do.call(cbind, sim_GP_list))
sim_PTS <- as.data.frame(do.call(cbind, sim_PTS_list))
sim_REB <- as.data.frame(do.call(cbind, sim_REB_list))
sim_AST <- as.data.frame(do.call(cbind, sim_AST_list))
sim_STL <- as.data.frame(do.call(cbind, sim_STL_list))
sim_BLK <- as.data.frame(do.call(cbind, sim_BLK_list))
sim_FGA <- as.data.frame(do.call(cbind, sim_FGA_list))
sim_FGpct <- as.data.frame(do.call(cbind, sim_FGpct_list))
sim_USGpct <- as.data.frame(do.call(cbind, sim_USGpct_list))
sim_PPS <- as.data.frame(do.call(cbind, sim_PPS_list))
sim_TSpct <- as.data.frame(do.call(cbind, sim_TSpct_list))
sim_ThreePA <- as.data.frame(do.call(cbind, sim_ThreePA_list))
sim_ThreePct <- as.data.frame(do.call(cbind, sim_ThreePct_list))
sim_TRBpct <- as.data.frame(do.call(cbind, sim_TRBpct_list))
sim_ASTpct <- as.data.frame(do.call(cbind, sim_ASTpct_list))
sim_STLpct <- as.data.frame(do.call(cbind, sim_STLpct_list))
sim_BLKpct <- as.data.frame(do.call(cbind, sim_BLKpct_list))
sim_OWS <- as.data.frame(do.call(cbind, sim_OWS_list))
sim_DWS <- as.data.frame(do.call(cbind, sim_DWS_list))
sim_WS <- as.data.frame(do.call(cbind, sim_WS_list))
sim_WS48 <- as.data.frame(do.call(cbind, sim_WS48_list))

#name data frames from above based on year iteration
assign(paste0("sim_players_", year), sim_players)
assign(paste0("sim_distances_", year), sim_distances)
assign(paste0("sim_schools_", year), sim_schools)
assign(paste0("sim_seasons_", year), sim_seasons)
assign(paste0("sim_GP_", year), sim_GP)
assign(paste0("sim_PTS_", year), sim_PTS)
assign(paste0("sim_REB_", year), sim_REB)
assign(paste0("sim_AST_", year), sim_AST)
assign(paste0("sim_STL_", year), sim_STL)
assign(paste0("sim_BLK_", year), sim_BLK)
assign(paste0("sim_FGA_", year), sim_FGA)
assign(paste0("sim_FGpct_", year), sim_FGpct)
assign(paste0("sim_USGpct_", year), sim_USGpct)
assign(paste0("sim_PPS_", year), sim_PPS)
assign(paste0("sim_TSpct_", year), sim_TSpct)
assign(paste0("sim_ThreePA_", year), sim_ThreePA)
assign(paste0("sim_ThreePct_", year), sim_ThreePct)
assign(paste0("sim_TRBpct_", year), sim_TRBpct)
assign(paste0("sim_ASTpct_", year), sim_ASTpct)
assign(paste0("sim_STLpct_", year), sim_STLpct)
assign(paste0("sim_BLKpct_", year), sim_BLKpct)
assign(paste0("sim_OWS_", year), sim_OWS)
assign(paste0("sim_DWS_", year), sim_DWS)
assign(paste0("sim_WS_", year), sim_WS)
assign(paste0("sim_WS48_", year), sim_WS48)

#rename columns in data frames
player_dfs <- c(paste0("sim_players_", year))
for(df in player_dfs)
  assign(df, setNames(get(df),  c("sim1", "sim2", "sim3", "sim4", "sim5", "sim6", "sim7", "sim8", "sim9", "sim10")))

distance_dfs <- c(paste0("sim_distances_", year))
for(df in distance_dfs)
  assign(df, setNames(get(df),  c("dist1", "dist2", "dist3", "dist4", "dist5", "dist6", "dist7", "dist8", "dist9", "dist10")))

school_dfs <- c(paste0("sim_schools_", year))
for(df in school_dfs)
  assign(df, setNames(get(df),  c("school1", "school2", "school3", "school4", "school5", "school6", "school7", "school8", "school9", "school10")))

season_dfs <- c(paste0("sim_seasons_", year))
for(df in season_dfs)
  assign(df, setNames(get(df),  c("seas1", "seas2", "seas3", "seas4", "seas5", "seas6", "seas7", "seas8", "seas9", "seas10")))

GP_dfs <- c(paste0("sim_GP_", year))
for(df in GP_dfs)
  assign(df, setNames(get(df),  c("GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10")))

PTS_dfs <- c(paste0("sim_PTS_", year))
for(df in PTS_dfs)
  assign(df, setNames(get(df),  c("PTS1", "PTS2", "PTS3", "PTS4", "PTS5", "PTS6", "PTS7", "PTS8", "PTS9", "PTS10")))

REB_dfs <- c(paste0("sim_REB_", year))
for(df in REB_dfs)
  assign(df, setNames(get(df),  c("REB1", "REB2", "REB3", "REB4", "REB5", "REB6", "REB7", "REB8", "REB9", "REB10")))

AST_dfs <- c(paste0("sim_AST_", year))
for(df in AST_dfs)
  assign(df, setNames(get(df),  c("AST1", "AST2", "AST3", "AST4", "AST5", "AST6", "AST7", "AST8", "AST9", "AST10")))

STL_dfs <- c(paste0("sim_STL_", year))
for(df in STL_dfs)
  assign(df, setNames(get(df),  c("STL1", "STL2", "STL3", "STL4", "STL5", "STL6", "STL7", "STL8", "STL9", "STL10")))

BLK_dfs <- c(paste0("sim_BLK_", year))
for(df in BLK_dfs)
  assign(df, setNames(get(df),  c("BLK1", "BLK2", "BLK3", "BLK4", "BLK5", "BLK6", "BLK7", "BLK8", "BLK9", "BLK10")))

FGA_dfs <- c(paste0("sim_FGA_", year))
for(df in FGA_dfs)
  assign(df, setNames(get(df),  c("FGA1", "FGA2", "FGA3", "FGA4", "FGA5", "FGA6", "FGA7", "FGA8", "FGA9", "FGA10")))

FGpct_dfs <- c(paste0("sim_FGpct_", year))
for(df in FGpct_dfs)
  assign(df, setNames(get(df),  c("FGpct1", "FGpct2", "FGpct3", "FGpct4", "FGpct5", "FGpct6", "FGpct7", "FGpct8", "FGpct9", "FGpct10")))

USGpct_dfs <- c(paste0("sim_USGpct_", year))
for(df in USGpct_dfs)
  assign(df, setNames(get(df),  c("USGpct1", "USGpct2", "USGpct3", "USGpct4", "USGpct5", "USGpct6", "USGpct7", "USGpct8", "USGpct9", "USGpct10")))

PPS_dfs <- c(paste0("sim_PPS_", year))
for(df in PPS_dfs)
  assign(df, setNames(get(df),  c("PPS1", "PPS2", "PPS3", "PPS4", "PPS5", "PPS6", "PPS7", "PPS8", "PPS9", "PPS10")))

TSpct_dfs <- c(paste0("sim_TSpct_", year))
for(df in TSpct_dfs)
  assign(df, setNames(get(df),  c("TSpct1", "TSpct2", "TSpct3", "TSpct4", "TSpct5", "TSpct6", "TSpct7", "TSpct8", "TSpct9", "TSpct10")))

ThreePA_dfs <- c(paste0("sim_ThreePA_", year))
for(df in ThreePA_dfs)
  assign(df, setNames(get(df),  c("ThreePA1", "ThreePA2", "ThreePA3", "ThreePA4", "ThreePA5", "ThreePA6", "ThreePA7", "ThreePA8", "ThreePA9", "ThreePA10")))

ThreePct_dfs <- c(paste0("sim_ThreePct_", year))
for(df in ThreePct_dfs)
  assign(df, setNames(get(df),  c("ThreePct1", "ThreePct2", "ThreePct3", "ThreePct4", "ThreePct5", "ThreePct6", "ThreePct7", "ThreePct8", "ThreePct9", "ThreePct10")))

TRBpct_dfs <- c(paste0("sim_TRBpct_", year))
for(df in TRBpct_dfs)
  assign(df, setNames(get(df),  c("TRBpct1", "TRBpct2", "TRBpct3", "TRBpct4", "TRBpct5", "TRBpct6", "TRBpct7", "TRBpct8", "TRBpct9", "TRBpct10")))

ASTpct_dfs <- c(paste0("sim_ASTpct_", year))
for(df in ASTpct_dfs)
  assign(df, setNames(get(df),  c("ASTpct1", "ASTpct2", "ASTpct3", "ASTpct4", "ASTpct5", "ASTpct6", "ASTpct7", "ASTpct8", "ASTpct9", "ASTpct10")))

STLpct_dfs <- c(paste0("sim_STLpct_", year))
for(df in STLpct_dfs)
  assign(df, setNames(get(df),  c("STLpct1", "STLpct2", "STLpct3", "STLpct4", "STLpct5", "STLpct6", "STLpct7", "STLpct8", "STLpct9", "STLpct10")))

BLKpct_dfs <- c(paste0("sim_BLKpct_", year))
for(df in BLKpct_dfs)
  assign(df, setNames(get(df),  c("BLKpct1", "BLKpct2", "BLKpct3", "BLKpct4", "BLKpct5", "BLKpct6", "BLKpct7", "BLKpct8", "BLKpct9", "BLKpct10")))

OWS_dfs <- c(paste0("sim_OWS_", year))
for(df in OWS_dfs)
  assign(df, setNames(get(df),  c("OWS1", "OWS2", "OWS3", "OWS4", "OWS5", "OWS6", "OWS7", "OWS8", "OWS9", "OWS10")))

DWS_dfs <- c(paste0("sim_DWS_", year))
for(df in DWS_dfs)
  assign(df, setNames(get(df),  c("DWS1", "DWS2", "DWS3", "DWS4", "DWS5", "DWS6", "DWS7", "DWS8", "DWS9", "DWS10")))

WS_dfs <- c(paste0("sim_WS_", year))
for(df in WS_dfs)
  assign(df, setNames(get(df),  c("WS1", "WS2", "WS3", "WS4", "WS5", "WS6", "WS7", "WS8", "WS9", "WS10")))


WS48_dfs <- c(paste0("sim_WS48_", year))
for(df in WS48_dfs)
  assign(df, setNames(get(df),  c("WS481", "WS482", "WS483", "WS484", "WS485", "WS486", "WS487", "WS488", "WS489", "WS4810")))


#combine all data
sim <- data.frame('Player' = current_players$Player, 'Player_ID' = current_players$Player_ID, 'School' = current_players$School, 'Season' = current_players$Season, 'Draft' = current_players$Draft,  get(paste0("sim_players_", year)), get(paste0("sim_distances_", year)), get(paste0("sim_schools_", year)), get(paste0("sim_seasons_", year)), get(paste0("sim_GP_", year)), get(paste0("sim_PTS_", year)), get(paste0("sim_REB_", year)), get(paste0("sim_AST_", year)), get(paste0("sim_STL_", year)), get(paste0("sim_BLK_", year)), get(paste0("sim_FGA_", year)), get(paste0("sim_FGpct_", year)), get(paste0("sim_USGpct_", year)), get(paste0("sim_PPS_", year)), get(paste0("sim_TSpct_", year)), get(paste0("sim_ThreePA_", year)), get(paste0("sim_ThreePct_", year)), get(paste0("sim_TRBpct_", year)), get(paste0("sim_ASTpct_", year)), get(paste0("sim_STLpct_", year)), get(paste0("sim_BLKpct_", year)), get(paste0("sim_OWS_", year)), get(paste0("sim_DWS_", year)), get(paste0("sim_WS_", year)), get(paste0("sim_WS48_", year)), stringsAsFactors = FALSE)

assign(paste0("sim_", year), sim)


}

#combine into one table and scale distances
#combine all tables together
advanced_per_min_top_25 <- rbind(sim_2010, sim_2011, sim_2012, sim_2013, sim_2014, sim_2015, sim_2016, sim_2017, sim_2018, sim_2019, sim_2020)


#convert distances to 0-100 scale based on max distance in nba
advanced_per_min_top_25[16:25] <- (1- (advanced_per_min_top_25[16:25] / advanced_per_min_top_25_max_dist)) * 100

```


################ Add College Stats to Each Output File and Export to Excel ###################

```{r}
#combine all tables into single list
comps <- list(basic, basic_nba, basic_opponents_greater_500, basic_opponents_greater_500_nba, basic_top_25, basic_top_25_nba, basic_conference_games, basic_conference_games_nba, basic_per_min, basic_per_min_nba, basic_per_min_opponents_greater_500, basic_per_min_opponents_greater_500_nba, basic_per_min_top_25, basic_per_min_top_25_nba, basic_per_min_conference_games, basic_per_min_conference_games_nba, advanced, advanced_nba, advanced_opponents_greater_500, advanced_opponents_greater_500_nba, advanced_top_25, advanced_top_25_nba, advanced_conference_games, advanced_conference_games_nba, advanced_per_min, advanced_per_min_nba, advanced_per_min_opponents_greater_500, advanced_per_min_opponents_greater_500_nba, advanced_per_min_top_25, advanced_per_min_top_25_nba, advanced_per_min_conference_games, advanced_per_min_conference_games_nba)

#set names in list for each item
names(comps) <- c("basic", "basic_nba", "basic_opp_above_500", "basic_opp_above_500_nba", "basic_top_25", "basic_top_25_nba", "basic_conference", "basic_conference_nba", "basic_pm", "basic_pm_nba", "basic_pm_opp_above_500", "basic_pm_opp_above_500_nba", "basic_pm_top_25", "basic_pm_top_25_nba", "basic_pm_conference", "basic_pm_conference_nba", "advanced", "advanced_nba", "advanced_opp_above_500", "advanced_opp_above_500_nba", "advanced_top_25", "advanced_top_25_nba", "advanced_conference", "advanced_conference_nba", "advanced_pm", "advanced_pm_nba", "advanced_pm_opp_above_500", "advanced_pm_opp_above_500_nba", "advanced_pm_top_25", "advanced_pm_top_25_nba", 
"advanced_pm_conference", "advanced_pm_conference_nba")


#reload csv files and combine into list for each type
#totals
stat_totals <- as_tibble(read.csv("ncaa_player_totals_2003_2020.csv"))
stat_totals_opp_above_500 <- as_tibble(read.csv("ncaa_player_totals_opponents_greater_500_2003_2020.csv"))
stat_totals_conference <- as_tibble(read.csv("ncaa_player_totals_conference_games_reg_season_2003_2020.csv"))
stat_totals_top_25 <- as_tibble(read.csv("ncaa_player_totals_opponents_top_25_2003_2020.csv"))
#combine into list
stat_totals.list <- list(stat_totals, stat_totals_opp_above_500, stat_totals_conference, stat_totals_top_25)

#player info
player_info <- as_tibble(read.csv("ncaa_player_info_2003_2020.csv"))

#misc
stat_misc <- as_tibble(read.csv("ncaa_player_misc_2003_2020.csv"))
stat_misc_opp_above_500 <- as_tibble(read.csv("ncaa_player_misc_opponents_greater_500_2003_2020.csv"))
stat_misc_conference <- as_tibble(read.csv("ncaa_player_misc_conference_games_reg_season_2003_2020.csv"))
stat_misc_top_25 <- as_tibble(read.csv("ncaa_player_misc_opponents_top_25_2003_2020.csv"))
#combine into list
stat_misc.list <- list(stat_misc, stat_misc_opp_above_500, stat_misc_conference, stat_misc_top_25)

#advanced
stat_advanced <- as_tibble(read.csv("ncaa_player_advanced_2003_2020.csv"))
stat_advanced_opp_above_500 <- as_tibble(read.csv("ncaa_player_advanced_opponents_greater_500_2003_2020.csv"))
stat_advanced_conference <- as_tibble(read.csv("ncaa_player_advanced_conference_games_reg_season_2003_2020.csv"))
stat_advanced_top_25 <- as_tibble(read.csv("ncaa_player_advanced_opponents_top_25_2003_2020.csv"))
#combine into list
stat_advanced.list <- list(stat_advanced, stat_advanced_opp_above_500, stat_advanced_conference, stat_advanced_top_25)



#convert totals stats to per game averages
stat_totals.list <- lapply(stat_totals.list, function(x) mutate(x, MIN=round(MIN/GP,1),
                       PTS=round(PTS/GP,1),
                       FGM=round(FGM/GP,1),
                       FGA=round(FGA/GP,1),
                       ThreePM=round(ThreePM/GP,1),
                       ThreePA=round(ThreePA/GP,1),
                       FTM=round(FTM/GP,1),
                       FTA=round(FTA/GP,1),
                       TOV=round(TOV/GP,1),
                       REB=round(REB/GP,1),
                       AST=round(AST/GP,1),
                       STL=round(STL/GP,1),
                       BLK=round(BLK/GP,1)))


#remove school column
stat_totals.list[[1]] <- subset(stat_totals.list[[1]], select=-c(School))
stat_totals.list[[2]] <- subset(stat_totals.list[[2]], select=-c(School))
stat_totals.list[[3]] <- subset(stat_totals.list[[3]], select=-c(School))
stat_totals.list[[4]] <- subset(stat_totals.list[[4]], select=-c(School))


#join with player info table to get player height, weight and class
stat_totals.list <- lapply(stat_totals.list, function(x) left_join(x, select(player_info, c(Player_ID, Season, School, Pos, HT, WT, Class)), by = c("Player_ID", "Season")))

#join advanced.list table to misc.list table to get player Win Shares
stat_advanced.list[[1]] <- left_join(stat_advanced.list[[1]],  select(stat_misc.list[[1]],  c(Player_ID, Season, OWS, DWS)), by = c("Player_ID", "Season"))
stat_advanced.list[[2]] <- left_join(stat_advanced.list[[2]],  select(stat_misc.list[[2]],  c(Player_ID, Season, OWS, DWS)), by = c("Player_ID", "Season"))
stat_advanced.list[[3]] <- left_join(stat_advanced.list[[3]],  select(stat_misc.list[[3]],  c(Player_ID, Season, OWS, DWS)), by = c("Player_ID", "Season"))
stat_advanced.list[[4]] <- left_join(stat_advanced.list[[4]],  select(stat_misc.list[[4]],  c(Player_ID, Season, OWS, DWS)), by = c("Player_ID", "Season"))


#combine stat_totals and advanced.list stat_totals                       
stat_totals.list[[1]] <- left_join(stat_totals.list[[1]], select(stat_advanced.list[[1]],  c("Player_ID", "Season", "TSpct", "eFGpct", "ORBpct", "DRBpct", "ASTpct", "STLpct", "BLKpct", "TOVpct", "USGpct", "PPS", "OWS", "DWS")), by=c("Player_ID", "Season"))       

stat_totals.list[[2]] <- left_join(stat_totals.list[[2]], select(stat_advanced.list[[2]],  c("Player_ID", "Season", "TSpct", "eFGpct", "ORBpct", "DRBpct", "ASTpct", "STLpct", "BLKpct", "TOVpct", "USGpct", "PPS", "OWS", "DWS")), by=c("Player_ID", "Season"))         

stat_totals.list[[3]] <- left_join(stat_totals.list[[3]], select(stat_advanced.list[[3]],  c("Player_ID", "Season", "TSpct", "eFGpct", "ORBpct", "DRBpct", "ASTpct", "STLpct", "BLKpct", "TOVpct", "USGpct", "PPS", "OWS", "DWS")), by=c("Player_ID", "Season"))         

stat_totals.list[[4]] <- left_join(stat_totals.list[[4]], select(stat_advanced.list[[4]],  c("Player_ID", "Season", "TSpct", "eFGpct", "ORBpct", "DRBpct", "ASTpct", "STLpct", "BLKpct", "TOVpct", "USGpct", "PPS", "OWS", "DWS")), by=c("Player_ID", "Season"))         




#append college stats columns with each table in comps list

#all games
comps[c("basic", "basic_nba", "basic_pm", "basic_pm_nba", "advanced", "advanced_nba", "advanced_pm", "advanced_pm_nba")] <- lapply(comps[c("basic", "basic_nba", "basic_pm", "basic_pm_nba", "advanced", "advanced_nba", "advanced_pm", "advanced_pm_nba")], function(x) left_join(x, select(stat_totals.list[[1]], c("Player_ID", "Season", "Pos", "GP", "Class", "HT", "WT", "MIN", "PTS", "FGM", "FGA", "FGpct", "ThreePM", "ThreePA", "ThreePct", "FTM", "FTA", "FTpct", "REB", "TOV", "AST", "STL", "BLK", "TSpct", "eFGpct", "ORBpct", "DRBpct", "ASTpct", "STLpct", "BLKpct", "TOVpct", "USGpct", "PPS", "OWS", "DWS")), by = c("Player_ID", "Season")))

#opponents above .500 
comps[c("basic_opp_above_500", "basic_opp_above_500_nba", "basic_pm_opp_above_500", "basic_pm_opp_above_500_nba", "advanced_opp_above_500", "advanced_opp_above_500_nba", "advanced_pm_opp_above_500", "advanced_pm_opp_above_500_nba")] <- lapply(comps[c("basic_opp_above_500", "basic_opp_above_500_nba", "basic_pm_opp_above_500", "basic_pm_opp_above_500_nba", "advanced_opp_above_500", "advanced_opp_above_500_nba", "advanced_pm_opp_above_500", "advanced_pm_opp_above_500_nba")], function(x) left_join(x, select(stat_totals.list[[2]], c("Player_ID", "Season", "Pos", "GP", "Class", "HT", "WT", "MIN", "PTS", "FGM", "FGA", "FGpct", "ThreePM", "ThreePA", "ThreePct", "FTM", "FTA", "FTpct", "REB", "TOV", "AST", "STL", "BLK", "TSpct", "eFGpct", "ORBpct", "DRBpct", "ASTpct", "STLpct", "BLKpct", "TOVpct", "USGpct", "PPS", "OWS", "DWS")), by = c("Player_ID", "Season")))

#conference
comps[c("basic_conference", "basic_conference_nba", "basic_pm_conference", "basic_pm_conference_nba", "advanced_conference", "advanced_conference_nba", "advanced_pm_conference", "advanced_pm_conference_nba")] <- lapply(comps[c("basic_conference", "basic_conference_nba", "basic_pm_conference", "basic_pm_conference_nba", "advanced_conference", "advanced_conference_nba", "advanced_pm_conference", "advanced_pm_conference_nba")], function(x) left_join(x, select(stat_totals.list[[3]], c("Player_ID", "Season", "Pos", "GP", "Class", "HT", "WT", "MIN", "PTS", "FGM", "FGA", "FGpct", "ThreePM", "ThreePA", "ThreePct", "FTM", "FTA", "FTpct", "REB", "TOV", "AST", "STL", "BLK", "TSpct", "eFGpct", "ORBpct", "DRBpct", "ASTpct", "STLpct", "BLKpct", "TOVpct", "USGpct", "PPS", "OWS", "DWS")), by = c("Player_ID", "Season")))

#top 25
comps[c("basic_top_25", "basic_top_25_nba", "basic_pm_top_25", "basic_pm_top_25_nba", "advanced_top_25", "advanced_top_25_nba", "advanced_pm_top_25", "advanced_pm_top_25_nba")] <- lapply(comps[c("basic_top_25", "basic_top_25_nba", "basic_pm_top_25", "basic_pm_top_25_nba", "advanced_top_25", "advanced_top_25_nba", "advanced_pm_top_25", "advanced_pm_top_25_nba")], function(x) left_join(x, select(stat_totals.list[[4]], c("Player_ID", "Season", "Pos", "GP", "Class", "HT", "WT", "MIN", "PTS", "FGM", "FGA", "FGpct", "ThreePM", "ThreePA", "ThreePct", "FTM", "FTA", "FTpct", "REB", "TOV", "AST", "STL", "BLK", "TSpct", "eFGpct", "ORBpct", "DRBpct", "ASTpct", "STLpct", "BLKpct", "TOVpct", "USGpct", "PPS", "OWS", "DWS")), by = c("Player_ID", "Season")))



#export to excel
library(writexl)
write_xlsx(comps, "nba_prospect_comps.xlsx")

```




